
[[quickstart-example]]
== Quickstart example
To give an example we want to provide two requisitions from an poor mans inventory as _XLS file_ (myInventory.xls).
The first requisition has an worksheet containing all router and the second worksheet has all server of our network.
This example can be found in `examples/source/xlsExample`.

.Worksheet with Router
image::images/myRouter.png[myRouter.png]

In line 5, 6 and 7 there is an Router defined with more than one IP interface.
All three interfaces will be manually provisioned.
The private IP interface with _192.168.30.1_ is not used for SNMP agent communication.
The services ICMP, SNMP and StrafePing are forced on some IP interfaces.
For all other IP interfaces you can use the OpenNMS Provisiond mechanism scanning IP interface table from SNMP and the detectors for additional services.
The server will also be categorized in _Backbone_ and _Office_.

.Worksheet with Server
image::images/myServer.png[myServer.png]

The _OpenNMS_ requisition should be provided via _HTTP_ and we use _OpenNMS Provisiond_ to synchronize it on a regular base.
We build the following file structure:

.File structure with two requisitions using a single spreadsheet
[source,bash]
----
[root@localhost opennms-pris]# pwd && tree
/opt/opennms-pris
.
├── documentation
├── examples
├── global.properties
├── lib/
├── opennms-pris.jar
├── opennms-pris.sh
└── requisitions/
    ├── myInventory.xls
    └── myRouter
        └── requisition.properties
    └── myServer
        └── requisition.properties
----

Providing the _OpenNMS requisition_ over _HTTP_ we create the following `global.properties`

.Use the HTTP web server
[source,bash]
----
include::examples/source/xlsExample/global.properties[]
----

The HTTP server is listening on localhost port 8000/TCP.
We have to create two directories, each directory `myServer` and `myRouter` have a `requisition.properties` file.
Both `requisition.properties` reference the main `myInventory.xls` file which contains two worksheets named _myServer_ and _myRouter_.
The `requisition.properties` is for both requisitions the same.
It is possible to create for each requisition different script or mapping steps.

.Configuration of the myRouter requisition
[source,bash]
----
include::examples/source/xlsExample/requisitions/myRouter/requisition.properties[]
----

.Configuration of the myServer requisition
[source,bash]
----
include::examples/source/xlsExample/requisitions/myRouter/requisition.properties[]
----

It is not necessary to restart the _pris_ server if you change property files or the _XLS_ file.
All changes will be executed with the next request against the server.
With the given configuration you see the result of the OpenNMS requisitions with the URL http://localhost:8000/myRouter and http://localhost:8000/myServer and can be used in _OpenNMS Provisiond_.

.Output of _PRIS_ server for the both configured requisitions
image::images/requisitions-http.png[requisitions-http.png]

To get configuration

.Configuration from OpenNMS Provisiond with provisiond-configuration.xml
[source,xml]
----
<requisition-def import-name="myRouter" import-url-resource="http://localhost:8000/myRouter">
  <cron-schedule>0 0 0 * * ? *</cron-schedule>
</requisition-def>

<requisition-def import-name="myServer" import-url-resource="http://localhost:8000/myServer">
  <cron-schedule>0 0 1 * * ? *</cron-schedule>
</requisition-def>
----
